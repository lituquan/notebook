## 网关的作用

统一入口
登录检测
鉴权
统一异常

### 内部的历史应用
对外域名：
    c端：
        http://web.xxx
    b端：内部管理后台
        http://manage.xxx
    接收端：回调用，比如微信、支付宝、短信、投保渠道
        http://external.xxx

第一代：all-in时代
    单体服务
    后台管理
    
    因为单体应用，域名直接进入了应用

第二代：服务化时代
    内部有2个应用，分别承载c端和b端的流量。但是这2个应用是服务耦合的，里面的转发方式不是透传的，有转发的能力，但是做成了应用，甚至有计算逻辑。

第三代：网关时代
    c端、b端和接收端都有一个网关，对应接收三个域名的流量。

### 三个网关
#### c端
    对路由配置，分为需要登录接口、不需要登录接口。
    里面的能力有：
        登录检测，token->userId
        记录日志
        脱敏过滤
        全局异常
            超时、内部错误 FallbackProvider

#### b端
    对路由配置，分为需要登录接口、不需要登录接口
    里面的能力有：
        登录检测，cas-token->operator
        记录日志
        权限拦截
            有无权限
            数据权限
        全局异常

#### 接收端
    用于接收第三方回调信息，打印日志            


### 动态路由
#### zuul 网关
    和spring比较好配合        
    1. 关联注册中心，配置还是在apollo 
    2. 使用注册路由

#### gateway 网关 
    转发到本地调试

## 坑

### 修改http status

### 修改header

### 地址调整
一开始以为是进来就错了

后来发现是权限修改导致

### 修改请求body

### 修改返回body

### 增加日志和调试
开启日志debug
写日志拦截打印

### skywalking 传递trace_id
    
### 配置文件问题
版本？文件！

### 注册中心+本地调试

ip模式

注册中心模式

前端--网关--对应服务：网关怎么寻址，注册中心 vs k8s